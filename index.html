<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Shopping List</title>
  <meta name="description" content="The Shopping List App">
  <meta name="author" content="Hannu JÃ¤rvinen">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!--<link rel="stylesheet" href="https://hannujarvinen.github.io/shoppinglist/css/styles.css">-->
  <link rel="stylesheet" href="./css/styles.css">
  <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!--<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">-->
  <!--<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>-->
  <!--<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>-->
  <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
  <script src="./js/bootbox.min.js"></script>
  <script>
	var listid = null;
    $(document).on("domChanged", function () {
	  <!--alert("domchange");-->
	  $("div.item").off("swipeleft");
	  $("div.item").off("swiperight");
	  $("div.itemtext").off("click");
	  $("div.ctrl").off("click");
	  $("button.btn-add").off("click");
	  $("div.item").on("swiperight",function(){
		<!--alert("swiperight");-->
		var item = $(this);
		if ( item.parent().attr("id") == "reservelist" ) {
			removeItem(item);
		} else {
			if ( item.parent().attr("id") == "currentlist" ) {
				moveToReserve(item);
			}
		}
	  });
	  $("div.item").on("swipeleft",function(){
		var item = $(this);
		moveToList(item);
	  });
	  $("div.itemtext").on("click",function(){
		<!--alert("click " + $(this).attr("id"));-->
		var item = $(this);
		bootbox.prompt({title:"Modify", value:item.html(), callback:function(result){
			if ( result != null && result != "" ) {
				item.html(result);
				}
							}
						});
		<!--var itemname = prompt("Modify",item.html());-->
		<!--if ( itemname != null ) {-->
		<!--	item.html(itemname);-->
		<!--}-->
	  });                       
	  $("div.ctrl").on("click",function(){
		<!--alert("click " + $(this).attr("id"));-->
		var item = $(this);
		if ( $("span",this).hasClass("glyphicon-arrow-right" )) {
			moveToReserve($(this).parent());
			return;
		}
		if ( $("span",this).hasClass("glyphicon-arrow-left" )) {
			moveToList($(this).parent());
			return;
		}
		if ( $("span",this).hasClass("glyphicon-trash" )) {
			removeItem($(this).parent());
			return;
		}
		if ( $("span",this).hasClass("glyphicon-minus" )) {
			minusOne($(this).parent());
			return;
		}
		if ( $("span",this).hasClass("glyphicon-plus" )) {
			plusOne($(this).parent());
			return;
		}
	  });                       
	  $("button.btn-add").on("click",function(){
		bootbox.prompt("New item", function(result){ addNewItem(result); });
	  });                       
    });
	$(document).on("pagecreate","#pageone",function(){
		init();
		$("body").trigger("domChanged");
	});
	
	function plusOne(item) {
		var itemtext = item.children().first().html();
		var splitted = itemtext.split(" ");
		var num = splitted[0];
		if ( !isNaN(num++) ) {
			splitted[0] = num;
			item.children().first().html(splitted.join(" "));
			return;
		} else {
			item.children().first().html("1 " + splitted.join(" "));
		}
	}
	function minusOne(item) {
		var itemtext = item.children().first().html();
		var splitted = itemtext.split(" ");
		if ( !isNaN(splitted[0]--) ) {
			if ( splitted[0] == 0 ) {
				splitted.shift();
			}
			item.children().first().html(splitted.join(" "));		
		}
	}
	function addNewItem(itemname) {
		<!--var itemname = prompt("New item","");-->
		if ( itemname != null && itemname != "" ) {
			var newItem = createNewCurrentListItem(itemname);
			newItem.appendTo("#currentlist");
		}
		$("body").trigger("domChanged");
		<!--var list = document.getElementById("currentlist"); -->
		<!--var tmp = list.appendChild(newItem); -->
		<!--$("#currentlist").append(newItem); -->
	}
	function createNewCurrentListItem(text) {
		<!--var div = document.createElement("div");-->
		var div = $('<div></div>')
		div.attr("class", "row item");
		<!--div.setAttribute("class", "row item");;-->
		div.append(newitemtextforcurrent(text));
		div.append(newminus());
		div.append(newplus());
		div.append(newarrowright());
		return div;
	}
	function createNewReserveListItem(text) {
		<!--var div = document.createElement("div");-->
		var div = $('<div></div>')
		div.attr("class", "row item");
		<!--div.setAttribute("class", "row item");;-->
		div.append(newitemtextforreserve(text));
		div.append(newarrowleft());
		div.append(newtrash());
		return div;
	}
	function moveToReserve(item) {
		<!--var tmp = item.clone();-->
		item.remove();
		//item.attr("class", "btn ui-btn ui-shadow ui-corner-all");
		$("div.ctrl",item).remove(); 
		$("div.itemtext",item).attr("class", "col-xs-7 text-center itemtext");
		item.append(newarrowleft());
		item.append(newtrash());
		item.appendTo(document.getElementById("reservelist"));
		$("body").trigger("domChanged");
	}
	function moveToList(item) {
		<!--var tmp = item.clone();-->
		item.remove();
		//tmp.attr("class", "btn btn-info ui-btn ui-shadow ui-corner-all");
		<!--tmp.remove(".ctrl");-->
		$("div.ctrl",item).remove(); 
		$("div.itemtext",item).attr("class", "col-xs-5 text-center itemtext");
		item.append(newminus());
		item.append(newplus());
		item.append(newarrowright());
		item.appendTo(document.getElementById("currentlist"));
		$("body").trigger("domChanged");
	}
	function moveAllToReserve() {
		var child = $("#currentlist").children().first();
		while ($("#currentlist").children().length != 0) {
			moveToReserve(child);
			child = $("#currentlist").children().first();
		}
	}
	function removeItem(item) {
		bootbox.confirm("Delete '" + item.children().first().html() + "' permanently?", function(result){ if (result) { item.remove(); } });
	}
	function newminus() {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-2 ctrl");
		var span = document.createElement("span");
		span.setAttribute("class", "glyphicon glyphicon-minus");
		span.setAttribute("aria-hidden", "true");
		div.append(span);
		return div;
	}
	function newplus() {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-2 ctrl");
		var span = document.createElement("span");
		span.setAttribute("class", "glyphicon glyphicon-plus");
		span.setAttribute("aria-hidden", "true");
		div.append(span);
		return div;
	}
	function newarrowright() {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-2 ctrl");
		var span = document.createElement("span");
		span.setAttribute("class", "glyphicon glyphicon-arrow-right");
		span.setAttribute("aria-hidden", "true");
		div.append(span);
		return div;
	}
	function newarrowleft() {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-2 ctrl");
		var span = document.createElement("span");
		span.setAttribute("class", "glyphicon glyphicon-arrow-left");
		span.setAttribute("aria-hidden", "true");
		div.append(span);
		return div;
	}
	function newtrash() {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-2 ctrl");
		var span = document.createElement("span");
		span.setAttribute("class", "glyphicon glyphicon-trash");
		span.setAttribute("aria-hidden", "true");
		div.append(span);
		return div;
	}
	function newitemtextforcurrent(text) {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-5 text-center itemtext");
		div.innerHTML = text;
		return div;
	}
	function newitemtextforreserve(text) {
		var div = document.createElement("div");
		div.setAttribute("class", "col-xs-7 text-center itemtext");
		div.innerHTML = text;
		return div;
	}
	function init() {
		// try to read listid from local storage
		//..
		// if listid found
		// getDB(listid);
		// if no list id found, this is first start
		// create new list or load existing one with listid
		var jsonstr = getDB(listid);
		var json = JSON.parse(jsonstr);
		listid = json.listid;
		for ( var i = 0; i < json.currentlist.length; i++) {
			var newItem = createNewCurrentListItem(json.currentlist[i]);
			newItem.appendTo("#currentlist");
		}
		for ( var i = 0; i < json.reservelist.length; i++) {
			var newItem = createNewReserveListItem(json.reservelist[i]);
			newItem.appendTo("#reservelist");
		}
	}
	function getDB(listid) {
		var jsonstr = '{"listid": "CDAsfSDGF", "currentlist": ["iKaffe", "Mysli"], "reservelist": ["Viili", "Maito", "Muroja"] }';
		return jsonstr;
	}
	function putDB(listid) {
		var data = new Object();
		data.listid = listid;
		var clistarray = [];
		var currentlist = $("#currentlist");
		for ( var i = 0; i < currentlist.children().length; i++ ) {
			clistarray.push($("div.itemtext",currentlist.children()[i]).html());
		}
		data.currentlist = clistarray;
		var rlistarray = [];
		var reservelist = $("#reservelist");
		for ( var i = 0; i < reservelist.children().length; i++ ) {
			rlistarray.push($("div.itemtext",reservelist.children()[i]).html());
		}
		data.reservelist = rlistarray;
		alert(JSON.stringify(data));
	}
	</script>
  <!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
<div data-role="page" id="pageone">
	<div class="container-fluid">

		<div class="row">
			<div class="col-xs-12 container-fluid">
				<button id="add" type="button" class="btn btn-info btn-lg pull-right btn-add" aria-label="Left Align">
				  <span class="glyphicon glyphicon-plus"></span>
				</button>
				<button id="add" type="button" class="btn btn-info btn-lg pull-right" aria-label="Left Align" onclick="moveAllToReserve()">
				  Clear list
				</button>
			</div>
			<div class="col-xs-12 sitename container-fluid">
			Shopping list
			</div>
		</div>
		
		<div class="row">
			<div id="currentlist" class="col-xs-6 container-fluid">
				<div class="row item">
					<div class="col-xs-5 text-center itemtext">Maito</div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-minus"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-plus"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-arrow-right"></span></div>
				</div>
				<div class="row item">
					<div class="col-xs-5 text-center itemtext">iKaffe</div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-minus"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-plus"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-arrow-right"></span></div>
				</div>
			</div>
			<div id="reservelist" class="col-xs-6 container-fluid">
				<div class="row item">
					<div class="col-xs-7 text-center itemtext">Murot</div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-arrow-left"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-trash"></span></div>
				</div>
				<div class="row item">
					<div class="col-xs-7 text-center itemtext">Viili</div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-arrow-left"></span></div>
					<div class="col-xs-2 ctrl"><span class="glyphicon glyphicon-trash"></span></div>
				</div>
			</div>
		</div>
	
	</div>

</div>


<!--  <script src="js/scripts.js"></script>-->
</body>
</html>